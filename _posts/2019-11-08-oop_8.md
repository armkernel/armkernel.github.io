---
layout : post
title : "[C++ OOP] State Pattern"
tags : [Design Pattern]
comments: true
---

### Intro
- State pattern에 대해 알아보자.

#### LOL을 생각해보자
![문도박사](../images/moondo.jpg){: width="210" height="200"){: .center}

- 게임을 즐겨본 분들이라면, 위 사진에 나와있는 케릭터를 가지고 많은 일을 할 수 것을 알 수 있다. (e.g. 공격, 달리기, 아이템 줍줍 등)
  - 그렇다면, 이런 케릭터는 어떻게 객체로 표현할 것인가?
  - GUI 로 표현하기에는 너무 많은 일을 하여야 하기 때문에 디자인 패턴 관점에서 본다면, 단순한 콘솔로 표현 할 수 있을 만큼으로 객체데이터를 제한해보자.

#### 단순한 케릭터 객체

```c
class Character
{
  int item = 0; // 다양한 아이템이라면, vector가 될 수도 있다.
public:
  void run() { cout << "run" << endl; }
  void attack() { cout << "attack" << endl; }
};

int main()
{
  Character* c;
  c->run();
  c->attack();
}
```
- 위와 같이 하나의 캐릭터는 아이템도 먹을 수 있고, 달릴수도 있고 심지어 공격도 할 수 있는 케릭터라고 생각해보자.. 사진과 같이 <mark>문도 박사</mark> 라고 생각하면 편할 것 같다:)

- 그런데 우리가 게임을 할 때, 아이템을 먹으면, 자연스럽게 공격력도 좋아지고 속도도 빨라지는 것을 느껴보지 않았는가? 
  - 아이템을 먹을 경우 우리는 파워 향상이나 스피드 향상을 구현해야한다. 어떻게 해야할까?

#### 단순한 item 추가 구현

- 아이템을 먹을 경우 단순하게 구현하면, 조건문을 이용하면된다. (e.g. switch, if)

```c
class Character
{
  int item = 0; 
public:
  void run() 
  { 
    if ( item == 0 ) {
      cout << "run" << endl;
    } else if (item == 1) {
      cout << "Boost ~ " << endl;
    }
  }

  void attack() 
  { 
    if ( item == 0 ) {
      cout << "attack" << endl;
    } else if ( item == 1 ) {
      cout << "power attack" << endl; }
    }
  }
};
```

- 위의 소스코드와 같이, 단순한 변수를 처리하는 알고리즘을 작성할 경우 어떤 문제가 생길까? 이 처리가 나쁜 것일까? 생각해보자.
  - 위의 코드의 문제는 무엇일까?
    - 아이템의 갯수는 한정적이지 않다는 게 문제이다. 아이템이 늘어날 경우 계속해서 조건문을 추가해야한다는 점이다. 아이템은 무지막지하게 늘어날 수 있기 때문에 코드가 무지막지하게 길어질 수 있다. 이럴 경우 유지보수 측면에서 문제가 생긴다.
  - 위의 코드 방법은 C에서는 많이 사용하였다. 예전에 C언어 같은 경우 class 개념이 없기 때문에 어떤 역할을 구별하기 위해서는 당연히 조건문을 고려해 짜야한다. 하지만, 우리는 C++을 이용하고 있기 때문에 ***변하는 것과 변하지 않는 것***을 구별 할 수 있는 기법들이 존재한다. 이 기법을 이용할 경우 유지보수에 용이하며, 성능적 측면에서 더 효율적이다.
- C++ 적으로 아이템을 처리하는 방법은 어떤게 있을까? (우리는 앞에서 많은 것들을 배웠다.. :D)
  - 가상함수를 이용해 나누는 방법
  - 클래스를 이용해 나누는 방법

#### 가상함수를 이용한 item 추가 구현 

- 첫째로 생각해 볼 수 있는 것이, 가상함수를 이용해 파생클래스에서 변하는 부분을 재정의 하는 것이다.

```c
class Character
{
  int item = 0;
public:
  void run() { runImp(); }
  void attack() { attackImp(); }

  // 아래 구체적인 것은 너희가 정의해라.. 지시
  virtual void runImp() = 0;
  virtual void attackImp() = 0;
};

class PowerItemCharacter : public Character
{
  virtual void runImp() override
  {
    cout << "fast run" << endl;
  }

  virtual void attackImp() override
  {
    cout << "power attack" << endl;
  }
};

class NormalCharacter : public Character
{
  virtual void runImp() override
  {
    cout << "run" << endl;
  }

  virtual void attackImp() override
  {
    cout << "attack" << endl;
  }
};

```
